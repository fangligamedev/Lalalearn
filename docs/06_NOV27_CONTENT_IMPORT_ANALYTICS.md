# ZLearn 11æœˆ27æ—¥å¼€å‘è®¡åˆ’
## å†…å®¹å¯¼å…¥ + æ•°æ®åˆ†æç³»ç»Ÿ

> **æ—¥æœŸ**: 2025-11-27  
> **é¢„ä¼°æ—¶é—´**: 6-8 å°æ—¶  
> **æ ¸å¿ƒç›®æ ‡**: ç”¨æˆ·è‡ªå®šä¹‰è¯¾ç¨‹ç”Ÿæˆ + å­¦ä¹ æ•°æ®æŒä¹…åŒ–åˆ†æ

---

## ğŸ“‹ å½“å‰è¿›åº¦æ€»ç»“

### âœ… å·²å®ŒæˆåŠŸèƒ½ (MVP Demo)
- Zeabur è¯¾ç¨‹: 10 å¼ åœ°å›¾ã€100 å…³å¡ï¼ŒæŒ‰åœ°å›¾/éš¾åº¦ç­›é€‰
- æ¦‚å¿µé¢˜å‹: å•é€‰/åˆ¤æ–­/å¡«ç©ºï¼ŒæŒ‰å°è¯•æ¬¡æ•°é™æ˜Ÿè¯„åˆ†
- èŠå¤©æ•™ç»ƒ: ä¸“ä¸šä¸¥è°¨å‹ + ç¾å˜‰éŸ³è‰²ï¼Œè‡ªåŠ¨æ³¨å…¥é¢˜ç›®ä¸Šä¸‹æ–‡
- å¤ç›˜é¢æ¿: å®Œæˆå…³å¡/æ˜Ÿæ•°/æ­£ç¡®ç‡/é”™é¢˜åˆ—è¡¨/æ˜¨æ—¥å­¦ä¹ æ—¶é•¿
- TTS/å¡«ç©ºæ˜¾ç¤ºä¿®å¤ï¼Œæ„å»ºé¢„è§ˆå¯ç”¨

### ğŸ¯ ä»Šæ—¥å¼€å‘ç›®æ ‡
1. **å†…å®¹å¯¼å…¥ä¸è¯¾ç¨‹ç”Ÿæˆ** - ç”¨æˆ·å¯å¯¼å…¥ PDF/MD/ç½‘é¡µç”Ÿæˆè‡ªå®šä¹‰è¯¾ç¨‹
2. **æ•°æ®æŒä¹…åŒ–ä¸åˆ†æ** - æ¸¸æˆåŒ–åŸ‹ç‚¹ + ç•™å­˜åˆ†æ + Zeabur æ•°æ®å¤‡ä»½

---

## ğŸš€ å¼€å‘è®¡åˆ’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NOV 27 DEVELOPMENT PLAN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  PHASE A: å†…å®¹å¯¼å…¥ä¸è¯¾ç¨‹ç”Ÿæˆ                        Est: 3-4 hours  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  Step A.1: å¯¼å…¥æœåŠ¡æ ¸å¿ƒ (PDF/MD/URL)                                â”‚
â”‚  Step A.2: AI è¯¾ç¨‹ç”ŸæˆæœåŠ¡                                          â”‚
â”‚  Step A.3: è¯¾ç¨‹åˆ›å»ºå‘å¯¼ UI                                          â”‚
â”‚  Step A.4: åŠ¨æ€è¯¾ç¨‹ç®¡ç†                                             â”‚
â”‚                                                                     â”‚
â”‚  PHASE B: æ•°æ®æŒä¹…åŒ–ä¸åˆ†æ                          Est: 3-4 hours  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  Step B.1: IndexedDB å­˜å‚¨æœåŠ¡                                       â”‚
â”‚  Step B.2: åŸ‹ç‚¹äº‹ä»¶æ”¶é›†                                             â”‚
â”‚  Step B.3: ç•™å­˜/å­¦ä¹ åˆ†æå¼•æ“                                         â”‚
â”‚  Step B.4: Zeabur æ•°æ®å¤‡ä»½æ–¹æ¡ˆ                                      â”‚
â”‚                                                                     â”‚
â”‚                                          Total Est: 6-8 hours      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# PHASE A: å†…å®¹å¯¼å…¥ä¸è¯¾ç¨‹ç”Ÿæˆ

## A.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CONTENT IMPORT FLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ç”¨æˆ·è¾“å…¥                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“„ PDFä¸Šä¼   |  ğŸ“ Markdownç²˜è´´  |  ğŸŒ ç½‘é¡µURL              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“Š è¯¾ç¨‹é…ç½®é¢æ¿                                             â”‚  â”‚
â”‚   â”‚  â€¢ åœ°å›¾æ•°é‡: [1-10]  æ»‘å—                                    â”‚  â”‚
â”‚   â”‚  â€¢ æ¯åœ°å›¾å…³å¡: [5-20] æ»‘å—                                   â”‚  â”‚
â”‚   â”‚  â€¢ éš¾åº¦åˆ†å¸ƒ: [å‡åŒ€/é€’å¢/éšæœº]                                 â”‚  â”‚
â”‚   â”‚  â€¢ åšé¢˜æ¨¡å¼: [é¡ºåº/éšæœº/è‡ªé€‚åº”]                               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ¤– AI è¯¾ç¨‹ç”Ÿæˆ                                              â”‚  â”‚
â”‚   â”‚  1. å†…å®¹è§£æ â†’ çŸ¥è¯†ç‚¹æå–                                     â”‚  â”‚
â”‚   â”‚  2. éš¾åº¦è¯„ä¼° â†’ å…³å¡åˆ†é…                                       â”‚  â”‚
â”‚   â”‚  3. é¢˜ç›®ç”Ÿæˆ â†’ å¤šé¢˜å‹åˆ†å¸ƒ                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“š è‡ªå®šä¹‰è¯¾ç¨‹ (ä¸ Python/Zeabur å¹³è¡Œ)                       â”‚  â”‚
â”‚   â”‚  â€¢ æ˜¾ç¤ºåœ¨è¯¾ç¨‹åˆ‡æ¢ Tab                                        â”‚  â”‚
â”‚   â”‚  â€¢ ç‹¬ç«‹è¿›åº¦è¿½è¸ª                                               â”‚  â”‚
â”‚   â”‚  â€¢ å¯ç¼–è¾‘/åˆ é™¤                                                â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step A.1: å¯¼å…¥æœåŠ¡æ ¸å¿ƒ

### ğŸ“¥ Input
- PDF æ–‡ä»¶ (é€šè¿‡ FileReader)
- Markdown æ–‡æœ¬
- ç½‘é¡µ URL (é€šè¿‡ Jina Reader API)

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/importService.ts
// ============================================================

export interface ImportSource {
  type: 'pdf' | 'markdown' | 'url';
  content: string | File;
  name?: string;
}

export interface ImportResult {
  success: boolean;
  text: string;
  metadata: {
    title: string;
    wordCount: number;
    estimatedTokens: number;
  };
  error?: string;
}

class ImportService {
  /**
   * PDF è§£æ (ä½¿ç”¨ pdf.js)
   */
  async parsePDF(file: File): Promise<ImportResult> {
    // ä½¿ç”¨ pdfjs-dist åº“æå–æ–‡æœ¬
    const pdfjsLib = await import('pdfjs-dist');
    pdfjsLib.GlobalWorkerOptions.workerSrc = 
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    
    let fullText = '';
    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const pageText = content.items.map((item: any) => item.str).join(' ');
      fullText += pageText + '\n\n';
    }
    
    return {
      success: true,
      text: fullText,
      metadata: {
        title: file.name.replace('.pdf', ''),
        wordCount: fullText.split(/\s+/).length,
        estimatedTokens: Math.round(fullText.length / 4)
      }
    };
  }

  /**
   * Markdown è§£æ
   */
  parseMarkdown(content: string, name?: string): ImportResult {
    // æå–æ ‡é¢˜
    const titleMatch = content.match(/^#\s+(.+)$/m);
    const title = titleMatch ? titleMatch[1] : name || 'æœªå‘½åæ–‡æ¡£';
    
    // ç§»é™¤ Markdown è¯­æ³•ï¼Œä¿ç•™çº¯æ–‡æœ¬
    const plainText = content
      .replace(/```[\s\S]*?```/g, '') // ç§»é™¤ä»£ç å—
      .replace(/`[^`]+`/g, '')        // ç§»é™¤è¡Œå†…ä»£ç 
      .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1') // é“¾æ¥ â†’ æ–‡æœ¬
      .replace(/[#*_~>`]/g, '')       // ç§»é™¤æ ‡è®°ç¬¦å·
      .trim();
    
    return {
      success: true,
      text: plainText,
      metadata: {
        title,
        wordCount: plainText.split(/\s+/).length,
        estimatedTokens: Math.round(plainText.length / 4)
      }
    };
  }

  /**
   * ç½‘é¡µæŠ“å– (Jina Reader API)
   */
  async fetchURL(url: string): Promise<ImportResult> {
    try {
      const readerUrl = `https://r.jina.ai/${url}`;
      const response = await fetch(readerUrl, {
        headers: { 'Accept': 'text/markdown' }
      });
      
      if (!response.ok) {
        throw new Error(`æŠ“å–å¤±è´¥: ${response.status}`);
      }
      
      const markdown = await response.text();
      return this.parseMarkdown(markdown, new URL(url).hostname);
    } catch (error) {
      return {
        success: false,
        text: '',
        metadata: { title: '', wordCount: 0, estimatedTokens: 0 },
        error: error instanceof Error ? error.message : 'ç½‘é¡µæŠ“å–å¤±è´¥'
      };
    }
  }

  /**
   * ç»Ÿä¸€å¯¼å…¥å…¥å£
   */
  async import(source: ImportSource): Promise<ImportResult> {
    switch (source.type) {
      case 'pdf':
        return this.parsePDF(source.content as File);
      case 'markdown':
        return this.parseMarkdown(source.content as string, source.name);
      case 'url':
        return this.fetchURL(source.content as string);
      default:
        return {
          success: false,
          text: '',
          metadata: { title: '', wordCount: 0, estimatedTokens: 0 },
          error: 'ä¸æ”¯æŒçš„å¯¼å…¥ç±»å‹'
        };
    }
  }
}

export const importService = new ImportService();
```

### ğŸ“¤ Output
- `src/services/importService.ts`

### âœ… éªŒæ”¶æ ‡å‡†
- PDF æ–‡ä»¶å¯æˆåŠŸè§£æä¸ºæ–‡æœ¬
- Markdown å†…å®¹å¯æ­£ç¡®æå–
- URL é€šè¿‡ Jina Reader è·å–å†…å®¹

---

## Step A.2: AI è¯¾ç¨‹ç”ŸæˆæœåŠ¡

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/courseGeneratorService.ts
// ============================================================

import { Course, ConceptLevel, ConceptQuestion } from '../types';

/** è¯¾ç¨‹ç”Ÿæˆé…ç½® */
export interface CourseGenerationConfig {
  mapCount: number;          // åœ°å›¾æ•°é‡ (1-10)
  levelsPerMap: number;      // æ¯åœ°å›¾å…³å¡æ•° (5-20)
  difficultyMode: 'uniform' | 'progressive' | 'random';  // éš¾åº¦åˆ†å¸ƒ
  questionMode: 'sequential' | 'random' | 'adaptive';    // åšé¢˜æ¨¡å¼
  questionTypes: ('single_choice' | 'true_false' | 'fill_blank')[]; // é¢˜å‹
}

/** é»˜è®¤é…ç½® */
export const DEFAULT_CONFIG: CourseGenerationConfig = {
  mapCount: 3,
  levelsPerMap: 10,
  difficultyMode: 'progressive',
  questionMode: 'sequential',
  questionTypes: ['single_choice', 'true_false', 'fill_blank']
};

class CourseGeneratorService {
  /**
   * ç”Ÿæˆè¯¾ç¨‹ Prompt
   */
  private buildPrompt(
    content: string,
    config: CourseGenerationConfig,
    mapIndex: number
  ): string {
    const totalLevels = config.levelsPerMap;
    const difficultyDesc = {
      uniform: 'æ‰€æœ‰é¢˜ç›®éš¾åº¦å‡åŒ€åˆ†å¸ƒ',
      progressive: 'éš¾åº¦ä»æ˜“åˆ°éš¾é€’å¢',
      random: 'éš¾åº¦éšæœºåˆ†å¸ƒ'
    }[config.difficultyMode];

    return `
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ•™è‚²å†…å®¹è®¾è®¡å¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ææ–™ç”Ÿæˆå­¦ä¹ å…³å¡ã€‚

ã€è¾“å…¥ææ–™ã€‘
${content.slice(0, 8000)} // é™åˆ¶ Token

ã€ç”Ÿæˆè¦æ±‚ã€‘
1. ç”Ÿæˆ ${totalLevels} ä¸ªå…³å¡
2. è¿™æ˜¯ç¬¬ ${mapIndex + 1} å¼ åœ°å›¾
3. éš¾åº¦åˆ†å¸ƒ: ${difficultyDesc}
4. é¢˜å‹åˆ†å¸ƒ: ${config.questionTypes.join('ã€')}
5. æ¯ä¸ªå…³å¡ 1 é“æ ¸å¿ƒé¢˜ç›®

ã€è¾“å‡ºæ ¼å¼ (ä¸¥æ ¼ JSON)ã€‘
{
  "mapTitle": "åœ°å›¾åç§°",
  "mapDescription": "åœ°å›¾æè¿°",
  "levels": [
    {
      "id": 1,
      "title": "å…³å¡æ ‡é¢˜",
      "difficulty": "easy|medium|hard",
      "question": {
        "type": "single_choice",
        "question": "é—®é¢˜æ–‡æœ¬",
        "options": [
          {"key": "A", "text": "é€‰é¡¹A"},
          {"key": "B", "text": "é€‰é¡¹B"},
          {"key": "C", "text": "é€‰é¡¹C"},
          {"key": "D", "text": "é€‰é¡¹D"}
        ],
        "correctAnswer": "B",
        "explanation": "è§£é‡Šè¯´æ˜"
      }
    }
  ]
}

æ³¨æ„:
- type ä¸º true_false æ—¶ï¼Œä½¿ç”¨ statement + correctAnswer (boolean)
- type ä¸º fill_blank æ—¶ï¼Œä½¿ç”¨ question (å«____) + correctAnswers (æ•°ç»„)
`;
  }

  /**
   * è°ƒç”¨ AI ç”Ÿæˆå•å¼ åœ°å›¾
   */
  async generateMap(
    content: string,
    config: CourseGenerationConfig,
    mapIndex: number
  ): Promise<{
    mapTitle: string;
    mapDescription: string;
    levels: ConceptLevel[];
  }> {
    const prompt = this.buildPrompt(content, config, mapIndex);
    
    // è°ƒç”¨ Gemini API
    const response = await fetch('https://hnd1.aihub.zeabur.ai/gemini/v1beta/models/gemini-2.0-flash:generateContent', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${process.env.GEMINI_API_KEY}`
      },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: {
          temperature: 0.7,
          maxOutputTokens: 4096,
          responseMimeType: 'application/json'
        }
      })
    });

    const data = await response.json();
    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '{}';
    
    // æ¸…ç†å¹¶è§£æ JSON
    const cleanText = text.replace(/```json\n?|\n?```/g, '').trim();
    return JSON.parse(cleanText);
  }

  /**
   * ç”Ÿæˆå®Œæ•´è¯¾ç¨‹
   */
  async generateCourse(
    content: string,
    courseName: string,
    config: CourseGenerationConfig,
    onProgress?: (current: number, total: number) => void
  ): Promise<Course> {
    const maps: { title: string; description: string; levels: ConceptLevel[] }[] = [];
    
    // åˆ†å—å†…å®¹ç”¨äºä¸åŒåœ°å›¾
    const chunkSize = Math.ceil(content.length / config.mapCount);
    
    for (let i = 0; i < config.mapCount; i++) {
      const chunk = content.slice(i * chunkSize, (i + 1) * chunkSize);
      onProgress?.(i + 1, config.mapCount);
      
      try {
        const mapData = await this.generateMap(chunk, config, i);
        
        // é‡æ–°ç¼–å·å…³å¡ ID
        const baseId = i * config.levelsPerMap;
        mapData.levels = mapData.levels.map((level, idx) => ({
          ...level,
          id: baseId + idx + 1,
          mapIndex: i,
          mapTitle: mapData.mapTitle
        }));
        
        maps.push({
          title: mapData.mapTitle,
          description: mapData.mapDescription,
          levels: mapData.levels
        });
      } catch (error) {
        console.error(`åœ°å›¾ ${i + 1} ç”Ÿæˆå¤±è´¥:`, error);
      }
      
      // é¿å… API é™æµ
      await new Promise(r => setTimeout(r, 1000));
    }

    // ç»„è£…è¯¾ç¨‹
    const allLevels = maps.flatMap(m => m.levels);
    
    return {
      id: `custom-${Date.now()}`,
      name: courseName,
      icon: 'ğŸ“š',
      description: `è‡ªå®šä¹‰è¯¾ç¨‹ - ${config.mapCount} å¼ åœ°å›¾ï¼Œ${allLevels.length} ä¸ªå…³å¡`,
      type: 'concept',
      maps: maps.map((m, i) => ({
        id: i,
        title: m.title,
        description: m.description,
        levelCount: m.levels.length
      })),
      levels: allLevels,
      config: config,
      createdAt: new Date().toISOString(),
      isCustom: true
    };
  }
}

export const courseGeneratorService = new CourseGeneratorService();
```

### ğŸ“¤ Output
- `src/services/courseGeneratorService.ts`

---

## Step A.3: è¯¾ç¨‹åˆ›å»ºå‘å¯¼ UI

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/components/course/CourseCreator.tsx
// ============================================================

import React, { useState } from 'react';
import { importService, ImportResult } from '../../services/importService';
import { courseGeneratorService, CourseGenerationConfig, DEFAULT_CONFIG } from '../../services/courseGeneratorService';
import { Course } from '../../types';

interface CourseCreatorProps {
  onComplete: (course: Course) => void;
  onCancel: () => void;
}

type Step = 'import' | 'configure' | 'generate' | 'complete';

const CourseCreator: React.FC<CourseCreatorProps> = ({ onComplete, onCancel }) => {
  const [step, setStep] = useState<Step>('import');
  const [importResult, setImportResult] = useState<ImportResult | null>(null);
  const [config, setConfig] = useState<CourseGenerationConfig>(DEFAULT_CONFIG);
  const [courseName, setCourseName] = useState('');
  const [generating, setGenerating] = useState(false);
  const [progress, setProgress] = useState({ current: 0, total: 0 });

  // === å¯¼å…¥å¤„ç† ===
  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    const result = await importService.import({ type: 'pdf', content: file });
    setImportResult(result);
    setCourseName(result.metadata.title);
  };

  const handleMarkdownPaste = (text: string) => {
    const result = importService.parseMarkdown(text);
    setImportResult(result);
    setCourseName(result.metadata.title || 'è‡ªå®šä¹‰è¯¾ç¨‹');
  };

  const handleURLFetch = async (url: string) => {
    const result = await importService.import({ type: 'url', content: url });
    setImportResult(result);
    setCourseName(result.metadata.title);
  };

  // === ç”Ÿæˆè¯¾ç¨‹ ===
  const handleGenerate = async () => {
    if (!importResult?.text) return;
    
    setGenerating(true);
    setStep('generate');
    
    try {
      const course = await courseGeneratorService.generateCourse(
        importResult.text,
        courseName,
        config,
        (current, total) => setProgress({ current, total })
      );
      
      // ä¿å­˜åˆ° localStorage
      const customCourses = JSON.parse(localStorage.getItem('zlearn_custom_courses') || '[]');
      customCourses.push(course);
      localStorage.setItem('zlearn_custom_courses', JSON.stringify(customCourses));
      
      setStep('complete');
      onComplete(course);
    } catch (error) {
      console.error('è¯¾ç¨‹ç”Ÿæˆå¤±è´¥:', error);
    } finally {
      setGenerating(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
      <div className="bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        
        {/* æ ‡é¢˜æ  */}
        <div className="p-6 border-b border-slate-700">
          <h2 className="text-2xl font-bold">âœ¨ åˆ›å»ºè‡ªå®šä¹‰è¯¾ç¨‹</h2>
          <p className="text-slate-400 mt-1">å¯¼å…¥å†…å®¹ï¼ŒAI è‡ªåŠ¨ç”Ÿæˆé—¯å…³é¢˜ç›®</p>
        </div>

        {/* Step 1: å¯¼å…¥ */}
        {step === 'import' && (
          <div className="p-6 space-y-6">
            {/* PDF ä¸Šä¼  */}
            <div>
              <label className="block text-sm font-medium mb-2">ğŸ“„ ä¸Šä¼  PDF æ–‡æ¡£</label>
              <input
                type="file"
                accept=".pdf"
                onChange={handleFileUpload}
                className="w-full p-3 bg-slate-700 rounded-xl file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-blue-600 file:text-white"
              />
            </div>

            {/* Markdown ç²˜è´´ */}
            <div>
              <label className="block text-sm font-medium mb-2">ğŸ“ ç²˜è´´ Markdown å†…å®¹</label>
              <textarea
                rows={4}
                placeholder="åœ¨æ­¤ç²˜è´´ Markdown æ–‡æœ¬..."
                onChange={(e) => handleMarkdownPaste(e.target.value)}
                className="w-full p-3 bg-slate-700 rounded-xl resize-none"
              />
            </div>

            {/* URL è¾“å…¥ */}
            <div>
              <label className="block text-sm font-medium mb-2">ğŸŒ è¾“å…¥ç½‘é¡µ URL</label>
              <div className="flex gap-2">
                <input
                  type="url"
                  placeholder="https://example.com/docs"
                  className="flex-1 p-3 bg-slate-700 rounded-xl"
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      handleURLFetch((e.target as HTMLInputElement).value);
                    }
                  }}
                />
                <button
                  onClick={() => {
                    const input = document.querySelector('input[type="url"]') as HTMLInputElement;
                    if (input?.value) handleURLFetch(input.value);
                  }}
                  className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-xl"
                >
                  æŠ“å–
                </button>
              </div>
            </div>

            {/* å¯¼å…¥ç»“æœé¢„è§ˆ */}
            {importResult && (
              <div className="p-4 bg-slate-700/50 rounded-xl">
                <div className="flex items-center gap-2 text-green-400 mb-2">
                  <span>âœ“</span>
                  <span className="font-medium">{importResult.metadata.title}</span>
                </div>
                <div className="text-sm text-slate-400">
                  çº¦ {importResult.metadata.wordCount} å­— Â· 
                  é¢„ä¼° {importResult.metadata.estimatedTokens} Token
                </div>
              </div>
            )}

            {/* ä¸‹ä¸€æ­¥æŒ‰é’® */}
            <div className="flex gap-3">
              <button
                onClick={onCancel}
                className="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl"
              >
                å–æ¶ˆ
              </button>
              <button
                onClick={() => setStep('configure')}
                disabled={!importResult?.success}
                className="flex-1 py-3 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 rounded-xl font-bold"
              >
                ä¸‹ä¸€æ­¥: é…ç½®è¯¾ç¨‹
              </button>
            </div>
          </div>
        )}

        {/* Step 2: é…ç½® */}
        {step === 'configure' && (
          <div className="p-6 space-y-6">
            {/* è¯¾ç¨‹åç§° */}
            <div>
              <label className="block text-sm font-medium mb-2">è¯¾ç¨‹åç§°</label>
              <input
                type="text"
                value={courseName}
                onChange={(e) => setCourseName(e.target.value)}
                className="w-full p-3 bg-slate-700 rounded-xl"
              />
            </div>

            {/* åœ°å›¾æ•°é‡ */}
            <div>
              <label className="block text-sm font-medium mb-2">
                åœ°å›¾æ•°é‡: <span className="text-blue-400">{config.mapCount}</span>
              </label>
              <input
                type="range"
                min={1}
                max={10}
                value={config.mapCount}
                onChange={(e) => setConfig({ ...config, mapCount: Number(e.target.value) })}
                className="w-full"
              />
              <div className="flex justify-between text-xs text-slate-500">
                <span>1</span>
                <span>10</span>
              </div>
            </div>

            {/* æ¯åœ°å›¾å…³å¡æ•° */}
            <div>
              <label className="block text-sm font-medium mb-2">
                æ¯åœ°å›¾å…³å¡: <span className="text-blue-400">{config.levelsPerMap}</span>
              </label>
              <input
                type="range"
                min={5}
                max={20}
                value={config.levelsPerMap}
                onChange={(e) => setConfig({ ...config, levelsPerMap: Number(e.target.value) })}
                className="w-full"
              />
              <div className="flex justify-between text-xs text-slate-500">
                <span>5</span>
                <span>20</span>
              </div>
            </div>

            {/* éš¾åº¦åˆ†å¸ƒ */}
            <div>
              <label className="block text-sm font-medium mb-2">éš¾åº¦åˆ†å¸ƒæ¨¡å¼</label>
              <div className="grid grid-cols-3 gap-2">
                {[
                  { value: 'uniform', label: 'å‡åŒ€', icon: 'âš–ï¸' },
                  { value: 'progressive', label: 'é€’å¢', icon: 'ğŸ“ˆ' },
                  { value: 'random', label: 'éšæœº', icon: 'ğŸ²' }
                ].map(opt => (
                  <button
                    key={opt.value}
                    onClick={() => setConfig({ ...config, difficultyMode: opt.value as any })}
                    className={`p-3 rounded-xl text-center transition-all ${
                      config.difficultyMode === opt.value
                        ? 'bg-blue-600 ring-2 ring-blue-400'
                        : 'bg-slate-700 hover:bg-slate-600'
                    }`}
                  >
                    <span className="text-xl block mb-1">{opt.icon}</span>
                    <span className="text-sm">{opt.label}</span>
                  </button>
                ))}
              </div>
            </div>

            {/* åšé¢˜æ¨¡å¼ */}
            <div>
              <label className="block text-sm font-medium mb-2">åšé¢˜æ¨¡å¼</label>
              <div className="grid grid-cols-3 gap-2">
                {[
                  { value: 'sequential', label: 'é¡ºåº', icon: 'â¡ï¸' },
                  { value: 'random', label: 'éšæœº', icon: 'ğŸ”€' },
                  { value: 'adaptive', label: 'è‡ªé€‚åº”', icon: 'ğŸ§ ' }
                ].map(opt => (
                  <button
                    key={opt.value}
                    onClick={() => setConfig({ ...config, questionMode: opt.value as any })}
                    className={`p-3 rounded-xl text-center transition-all ${
                      config.questionMode === opt.value
                        ? 'bg-blue-600 ring-2 ring-blue-400'
                        : 'bg-slate-700 hover:bg-slate-600'
                    }`}
                  >
                    <span className="text-xl block mb-1">{opt.icon}</span>
                    <span className="text-sm">{opt.label}</span>
                  </button>
                ))}
              </div>
            </div>

            {/* é¢„è§ˆ */}
            <div className="p-4 bg-slate-700/50 rounded-xl">
              <h4 className="font-medium mb-2">ğŸ“Š è¯¾ç¨‹é¢„è§ˆ</h4>
              <p className="text-sm text-slate-400">
                å°†ç”Ÿæˆ <span className="text-white font-bold">{config.mapCount}</span> å¼ åœ°å›¾ï¼Œ
                å…± <span className="text-white font-bold">{config.mapCount * config.levelsPerMap}</span> ä¸ªå…³å¡
              </p>
            </div>

            {/* æ“ä½œæŒ‰é’® */}
            <div className="flex gap-3">
              <button
                onClick={() => setStep('import')}
                className="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl"
              >
                ä¸Šä¸€æ­¥
              </button>
              <button
                onClick={handleGenerate}
                className="flex-1 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 rounded-xl font-bold"
              >
                ğŸš€ å¼€å§‹ç”Ÿæˆ
              </button>
            </div>
          </div>
        )}

        {/* Step 3: ç”Ÿæˆä¸­ */}
        {step === 'generate' && (
          <div className="p-6 text-center space-y-6">
            <div className="text-6xl animate-bounce">ğŸ¤–</div>
            <h3 className="text-xl font-bold">AI æ­£åœ¨ç”Ÿæˆè¯¾ç¨‹...</h3>
            <p className="text-slate-400">
              æ­£åœ¨ç”Ÿæˆç¬¬ {progress.current} / {progress.total} å¼ åœ°å›¾
            </p>
            <div className="w-full h-3 bg-slate-700 rounded-full overflow-hidden">
              <div
                className="h-full bg-gradient-to-r from-purple-600 to-blue-600 transition-all duration-500"
                style={{ width: `${(progress.current / Math.max(progress.total, 1)) * 100}%` }}
              />
            </div>
            <p className="text-sm text-slate-500">
              é¢„è®¡éœ€è¦ {progress.total * 3} ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…
            </p>
          </div>
        )}

        {/* Step 4: å®Œæˆ */}
        {step === 'complete' && (
          <div className="p-6 text-center space-y-6">
            <div className="text-6xl">ğŸ‰</div>
            <h3 className="text-xl font-bold">è¯¾ç¨‹åˆ›å»ºæˆåŠŸï¼</h3>
            <p className="text-slate-400">
              "{courseName}" å·²æ·»åŠ åˆ°ä½ çš„è¯¾ç¨‹åˆ—è¡¨
            </p>
            <button
              onClick={onCancel}
              className="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold"
            >
              å¼€å§‹å­¦ä¹ 
            </button>
          </div>
        )}

      </div>
    </div>
  );
};

export default CourseCreator;
```

### ğŸ“¤ Output
- `src/components/course/CourseCreator.tsx`

---

## Step A.4: åŠ¨æ€è¯¾ç¨‹ç®¡ç†

### ğŸ“ Spec

åœ¨ `App.tsx` æˆ– `LevelMap.tsx` ä¸­é›†æˆè‡ªå®šä¹‰è¯¾ç¨‹ï¼š

```typescript
// è·å–æ‰€æœ‰è¯¾ç¨‹ï¼ˆå†…ç½® + è‡ªå®šä¹‰ï¼‰
const getAllCourses = (): Course[] => {
  const builtinCourses = [PYTHON_COURSE, ZEABUR_COURSE];
  const customCourses = JSON.parse(localStorage.getItem('zlearn_custom_courses') || '[]');
  return [...builtinCourses, ...customCourses];
};

// åˆ é™¤è‡ªå®šä¹‰è¯¾ç¨‹
const deleteCustomCourse = (courseId: string) => {
  const courses = JSON.parse(localStorage.getItem('zlearn_custom_courses') || '[]');
  const filtered = courses.filter((c: Course) => c.id !== courseId);
  localStorage.setItem('zlearn_custom_courses', JSON.stringify(filtered));
};
```

---

# PHASE B: æ•°æ®æŒä¹…åŒ–ä¸åˆ†æ

## B.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATA ANALYTICS ARCHITECTURE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ç”¨æˆ·è¡Œä¸º                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“Š åŸ‹ç‚¹äº‹ä»¶                                                  â”‚  â”‚
â”‚   â”‚  â€¢ é¡µé¢è®¿é—®  â€¢ ç­”é¢˜è¡Œä¸º  â€¢ å­¦ä¹ æ—¶é•¿  â€¢ é”™è¯¯ç‡                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ’¾ IndexedDB å­˜å‚¨                                           â”‚  â”‚
â”‚   â”‚  â€¢ events: åŸ‹ç‚¹äº‹ä»¶                                          â”‚  â”‚
â”‚   â”‚  â€¢ users: ç”¨æˆ·æ•°æ®                                           â”‚  â”‚
â”‚   â”‚  â€¢ progress: å­¦ä¹ è¿›åº¦                                        â”‚  â”‚
â”‚   â”‚  â€¢ analytics: åˆ†ææ±‡æ€»                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ğŸ“ˆ åˆ†æå¼•æ“                                                  â”‚  â”‚
â”‚   â”‚  â€¢ ç•™å­˜åˆ†æ (D1/D7/D30)                                      â”‚  â”‚
â”‚   â”‚  â€¢ å­¦ä¹ ä¹ æƒ¯ (æ—¶æ®µ/æ—¶é•¿/é¢‘ç‡)                                  â”‚  â”‚
â”‚   â”‚  â€¢ å¡ç‚¹åˆ†æ (é”™é¢˜/æ”¾å¼ƒ)                                       â”‚  â”‚
â”‚   â”‚  â€¢ è¡Œä¸ºæ¼æ–—                                                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â˜ï¸ Zeabur å¤‡ä»½ (æ‰‹åŠ¨å¯¼å‡º/å®šæ—¶)                               â”‚  â”‚
â”‚   â”‚  â€¢ JSON å¯¼å‡ºä¸‹è½½                                             â”‚  â”‚
â”‚   â”‚  â€¢ å¯é€‰: ä¸Šä¼ åˆ° Zeabur Object Storage                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step B.1: IndexedDB å­˜å‚¨æœåŠ¡

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/storageService.ts
// ============================================================

import { openDB, IDBPDatabase } from 'idb';

const DB_NAME = 'zlearn_db';
const DB_VERSION = 1;

export interface AnalyticsEvent {
  id: string;
  type: string;
  userId: string;
  sessionId: string;
  timestamp: number;
  data: Record<string, any>;
}

export interface UserProgress {
  id: string;
  courseId: string;
  levelId: number;
  stars: number;
  attempts: number;
  timeSpent: number;
  completedAt: number;
}

export interface LearningSession {
  id: string;
  userId: string;
  startTime: number;
  endTime?: number;
  duration: number;
  levelsCompleted: number;
  correctAnswers: number;
  wrongAnswers: number;
}

class StorageService {
  private db: IDBPDatabase | null = null;

  async init(): Promise<void> {
    this.db = await openDB(DB_NAME, DB_VERSION, {
      upgrade(db) {
        // åŸ‹ç‚¹äº‹ä»¶è¡¨
        if (!db.objectStoreNames.contains('events')) {
          const eventStore = db.createObjectStore('events', { keyPath: 'id' });
          eventStore.createIndex('type', 'type');
          eventStore.createIndex('userId', 'userId');
          eventStore.createIndex('timestamp', 'timestamp');
        }

        // å­¦ä¹ è¿›åº¦è¡¨
        if (!db.objectStoreNames.contains('progress')) {
          const progressStore = db.createObjectStore('progress', { keyPath: 'id' });
          progressStore.createIndex('courseId', 'courseId');
          progressStore.createIndex('userId', 'userId');
        }

        // å­¦ä¹ ä¼šè¯è¡¨
        if (!db.objectStoreNames.contains('sessions')) {
          const sessionStore = db.createObjectStore('sessions', { keyPath: 'id' });
          sessionStore.createIndex('userId', 'userId');
          sessionStore.createIndex('startTime', 'startTime');
        }

        // è‡ªå®šä¹‰è¯¾ç¨‹è¡¨
        if (!db.objectStoreNames.contains('courses')) {
          db.createObjectStore('courses', { keyPath: 'id' });
        }
      }
    });
  }

  // === åŸ‹ç‚¹äº‹ä»¶ ===
  async addEvent(event: Omit<AnalyticsEvent, 'id'>): Promise<string> {
    const id = `evt_${Date.now()}_${Math.random().toString(36).slice(2)}`;
    await this.db?.put('events', { ...event, id });
    return id;
  }

  async getEvents(
    filter?: { type?: string; userId?: string; startTime?: number; endTime?: number }
  ): Promise<AnalyticsEvent[]> {
    let events = await this.db?.getAll('events') || [];
    
    if (filter?.type) {
      events = events.filter(e => e.type === filter.type);
    }
    if (filter?.userId) {
      events = events.filter(e => e.userId === filter.userId);
    }
    if (filter?.startTime) {
      events = events.filter(e => e.timestamp >= filter.startTime!);
    }
    if (filter?.endTime) {
      events = events.filter(e => e.timestamp <= filter.endTime!);
    }
    
    return events;
  }

  // === å­¦ä¹ è¿›åº¦ ===
  async saveProgress(progress: UserProgress): Promise<void> {
    await this.db?.put('progress', progress);
  }

  async getProgress(userId: string, courseId?: string): Promise<UserProgress[]> {
    let progress = await this.db?.getAll('progress') || [];
    progress = progress.filter(p => p.userId === userId);
    if (courseId) {
      progress = progress.filter(p => p.courseId === courseId);
    }
    return progress;
  }

  // === å­¦ä¹ ä¼šè¯ ===
  async startSession(userId: string): Promise<string> {
    const id = `sess_${Date.now()}`;
    await this.db?.put('sessions', {
      id,
      userId,
      startTime: Date.now(),
      duration: 0,
      levelsCompleted: 0,
      correctAnswers: 0,
      wrongAnswers: 0
    });
    return id;
  }

  async endSession(sessionId: string): Promise<void> {
    const session = await this.db?.get('sessions', sessionId);
    if (session) {
      session.endTime = Date.now();
      session.duration = session.endTime - session.startTime;
      await this.db?.put('sessions', session);
    }
  }

  // === æ•°æ®å¯¼å‡º (å¤‡ä»½) ===
  async exportAllData(): Promise<string> {
    const data = {
      exportedAt: new Date().toISOString(),
      events: await this.db?.getAll('events'),
      progress: await this.db?.getAll('progress'),
      sessions: await this.db?.getAll('sessions'),
      courses: await this.db?.getAll('courses')
    };
    return JSON.stringify(data, null, 2);
  }

  // === æ•°æ®å¯¼å…¥ (æ¢å¤) ===
  async importData(jsonString: string): Promise<void> {
    const data = JSON.parse(jsonString);
    
    if (data.events) {
      for (const event of data.events) {
        await this.db?.put('events', event);
      }
    }
    if (data.progress) {
      for (const prog of data.progress) {
        await this.db?.put('progress', prog);
      }
    }
    if (data.sessions) {
      for (const session of data.sessions) {
        await this.db?.put('sessions', session);
      }
    }
    if (data.courses) {
      for (const course of data.courses) {
        await this.db?.put('courses', course);
      }
    }
  }

  // === æ¸…ç†æ—§æ•°æ® ===
  async cleanOldEvents(daysToKeep: number = 30): Promise<number> {
    const cutoff = Date.now() - daysToKeep * 24 * 60 * 60 * 1000;
    const events = await this.getEvents({ endTime: cutoff });
    
    for (const event of events) {
      await this.db?.delete('events', event.id);
    }
    
    return events.length;
  }
}

export const storageService = new StorageService();
```

### ğŸ“¤ Output
- `src/services/storageService.ts`

---

## Step B.2: åŸ‹ç‚¹äº‹ä»¶æ”¶é›†

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/analyticsService.ts
// ============================================================

import { storageService, AnalyticsEvent } from './storageService';
import { v4 as uuid } from 'uuid';

// é¢„å®šä¹‰äº‹ä»¶ç±»å‹
export const EVENTS = {
  // é¡µé¢äº‹ä»¶
  PAGE_VIEW: 'page_view',
  SESSION_START: 'session_start',
  SESSION_END: 'session_end',

  // è¯¾ç¨‹äº‹ä»¶
  COURSE_SELECT: 'course_select',
  COURSE_CREATE: 'course_create',

  // å­¦ä¹ äº‹ä»¶
  LEVEL_START: 'level_start',
  LEVEL_COMPLETE: 'level_complete',
  LEVEL_FAIL: 'level_fail',
  LEVEL_ABANDON: 'level_abandon',

  // ç­”é¢˜äº‹ä»¶
  ANSWER_SUBMIT: 'answer_submit',
  ANSWER_CORRECT: 'answer_correct',
  ANSWER_WRONG: 'answer_wrong',
  HINT_REQUEST: 'hint_request',

  // æ•™ç»ƒäº‹ä»¶
  COACH_CHAT: 'coach_chat',
  COACH_TTS: 'coach_tts',

  // å¤ç›˜äº‹ä»¶
  REVIEW_OPEN: 'review_open',
  REVIEW_AI_SUMMARY: 'review_ai_summary'
} as const;

class AnalyticsService {
  private userId: string = '';
  private sessionId: string = '';
  private eventQueue: Omit<AnalyticsEvent, 'id'>[] = [];
  private flushTimer: number | null = null;

  init(userId: string) {
    this.userId = userId;
    this.sessionId = uuid();
    this.track(EVENTS.SESSION_START, {});
    
    // æ¯ 10 ç§’æ‰¹é‡å†™å…¥
    this.flushTimer = window.setInterval(() => this.flush(), 10000);
    
    // é¡µé¢å…³é—­å‰å†™å…¥
    window.addEventListener('beforeunload', () => {
      this.track(EVENTS.SESSION_END, {});
      this.flush();
    });
  }

  track(type: string, data: Record<string, any>) {
    this.eventQueue.push({
      type,
      userId: this.userId,
      sessionId: this.sessionId,
      timestamp: Date.now(),
      data
    });

    // é‡è¦äº‹ä»¶ç«‹å³å†™å…¥
    if ([EVENTS.LEVEL_COMPLETE, EVENTS.SESSION_END].includes(type as any)) {
      this.flush();
    }
  }

  private async flush() {
    if (this.eventQueue.length === 0) return;
    
    const events = [...this.eventQueue];
    this.eventQueue = [];
    
    for (const event of events) {
      await storageService.addEvent(event);
    }
  }

  // === ä¾¿æ·æ–¹æ³• ===
  trackPageView(page: string) {
    this.track(EVENTS.PAGE_VIEW, { page });
  }

  trackLevelStart(courseId: string, levelId: number) {
    this.track(EVENTS.LEVEL_START, { courseId, levelId, startTime: Date.now() });
  }

  trackLevelComplete(courseId: string, levelId: number, stars: number, timeSpent: number) {
    this.track(EVENTS.LEVEL_COMPLETE, { courseId, levelId, stars, timeSpent });
  }

  trackAnswer(courseId: string, levelId: number, correct: boolean, attemptNumber: number) {
    this.track(correct ? EVENTS.ANSWER_CORRECT : EVENTS.ANSWER_WRONG, {
      courseId,
      levelId,
      attemptNumber
    });
  }

  destroy() {
    if (this.flushTimer) {
      clearInterval(this.flushTimer);
    }
    this.flush();
  }
}

export const analyticsService = new AnalyticsService();
```

### ğŸ“¤ Output
- `src/services/analyticsService.ts`

---

## Step B.3: ç•™å­˜/å­¦ä¹ åˆ†æå¼•æ“

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/services/analysisService.ts
// ============================================================

import { storageService, AnalyticsEvent } from './storageService';
import { EVENTS } from './analyticsService';

export interface RetentionData {
  d1: number;  // æ¬¡æ—¥ç•™å­˜ç‡ %
  d7: number;  // 7æ—¥ç•™å­˜ç‡ %
  d30: number; // 30æ—¥ç•™å­˜ç‡ %
}

export interface LearningHabits {
  preferredHours: number[];   // åå¥½å­¦ä¹ æ—¶æ®µ
  avgSessionDuration: number; // å¹³å‡å­¦ä¹ æ—¶é•¿ (åˆ†é’Ÿ)
  avgLevelsPerSession: number; // æ¯æ¬¡å­¦ä¹ å®Œæˆå…³å¡æ•°
  weeklyFrequency: number;    // å‘¨å­¦ä¹ é¢‘ç‡
}

export interface BottleneckAnalysis {
  levelId: number;
  courseId: string;
  failRate: number;      // å¤±è´¥ç‡ %
  avgAttempts: number;   // å¹³å‡å°è¯•æ¬¡æ•°
  abandonRate: number;   // æ”¾å¼ƒç‡ %
}

class AnalysisService {
  /**
   * è®¡ç®—ç•™å­˜ç‡
   */
  async calculateRetention(userId: string): Promise<RetentionData> {
    const now = Date.now();
    const day = 24 * 60 * 60 * 1000;
    
    const sessions = await storageService.getEvents({
      userId,
      type: EVENTS.SESSION_START
    });
    
    if (sessions.length === 0) {
      return { d1: 0, d7: 0, d30: 0 };
    }
    
    const firstSession = Math.min(...sessions.map(s => s.timestamp));
    const daysSinceFirst = Math.floor((now - firstSession) / day);
    
    // æ£€æŸ¥æŒ‡å®šå¤©æ•°åæ˜¯å¦æœ‰æ´»åŠ¨
    const hasActivityAfter = (days: number) => {
      const targetTime = firstSession + days * day;
      return sessions.some(s => s.timestamp >= targetTime && s.timestamp < targetTime + day);
    };
    
    return {
      d1: daysSinceFirst >= 1 && hasActivityAfter(1) ? 100 : 0,
      d7: daysSinceFirst >= 7 && hasActivityAfter(7) ? 100 : 0,
      d30: daysSinceFirst >= 30 && hasActivityAfter(30) ? 100 : 0
    };
  }

  /**
   * åˆ†æå­¦ä¹ ä¹ æƒ¯
   */
  async analyzeLearningHabits(userId: string): Promise<LearningHabits> {
    const events = await storageService.getEvents({ userId });
    
    // ç»Ÿè®¡å­¦ä¹ æ—¶æ®µ
    const hourCounts: number[] = new Array(24).fill(0);
    events.forEach(e => {
      const hour = new Date(e.timestamp).getHours();
      hourCounts[hour]++;
    });
    
    // æ‰¾å‡ºåå¥½æ—¶æ®µ (æ´»åŠ¨æœ€å¤šçš„ 3 ä¸ªå°æ—¶)
    const preferredHours = hourCounts
      .map((count, hour) => ({ hour, count }))
      .sort((a, b) => b.count - a.count)
      .slice(0, 3)
      .map(h => h.hour);
    
    // è®¡ç®—å¹³å‡ä¼šè¯æ—¶é•¿
    const sessions = events.filter(e => e.type === EVENTS.SESSION_START);
    const sessionEnds = events.filter(e => e.type === EVENTS.SESSION_END);
    
    let totalDuration = 0;
    sessions.forEach(start => {
      const end = sessionEnds.find(e => 
        e.sessionId === start.sessionId && e.timestamp > start.timestamp
      );
      if (end) {
        totalDuration += end.timestamp - start.timestamp;
      }
    });
    
    const avgSessionDuration = sessions.length > 0 
      ? Math.round(totalDuration / sessions.length / 60000) 
      : 0;
    
    // è®¡ç®—æ¯æ¬¡å­¦ä¹ å®Œæˆå…³å¡æ•°
    const completions = events.filter(e => e.type === EVENTS.LEVEL_COMPLETE);
    const avgLevelsPerSession = sessions.length > 0 
      ? Math.round(completions.length / sessions.length * 10) / 10 
      : 0;
    
    // è®¡ç®—å‘¨å­¦ä¹ é¢‘ç‡
    const oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
    const weekSessions = sessions.filter(s => s.timestamp >= oneWeekAgo);
    const uniqueDays = new Set(
      weekSessions.map(s => new Date(s.timestamp).toDateString())
    ).size;
    
    return {
      preferredHours,
      avgSessionDuration,
      avgLevelsPerSession,
      weeklyFrequency: uniqueDays
    };
  }

  /**
   * å¡ç‚¹åˆ†æ
   */
  async analyzeBottlenecks(userId?: string): Promise<BottleneckAnalysis[]> {
    const filter = userId ? { userId } : undefined;
    const events = await storageService.getEvents(filter);
    
    // æŒ‰å…³å¡åˆ†ç»„ç»Ÿè®¡
    const levelStats: Map<string, {
      starts: number;
      completes: number;
      fails: number;
      abandons: number;
      totalAttempts: number;
    }> = new Map();
    
    events.forEach(e => {
      if (![EVENTS.LEVEL_START, EVENTS.LEVEL_COMPLETE, EVENTS.LEVEL_FAIL, EVENTS.LEVEL_ABANDON].includes(e.type as any)) {
        return;
      }
      
      const key = `${e.data.courseId}-${e.data.levelId}`;
      const stats = levelStats.get(key) || {
        starts: 0, completes: 0, fails: 0, abandons: 0, totalAttempts: 0
      };
      
      switch (e.type) {
        case EVENTS.LEVEL_START:
          stats.starts++;
          break;
        case EVENTS.LEVEL_COMPLETE:
          stats.completes++;
          break;
        case EVENTS.LEVEL_FAIL:
          stats.fails++;
          stats.totalAttempts++;
          break;
        case EVENTS.LEVEL_ABANDON:
          stats.abandons++;
          break;
      }
      
      levelStats.set(key, stats);
    });
    
    // è½¬æ¢ä¸ºåˆ†æç»“æœå¹¶æ’åº
    return Array.from(levelStats.entries())
      .map(([key, stats]) => {
        const [courseId, levelId] = key.split('-');
        return {
          levelId: Number(levelId),
          courseId,
          failRate: stats.starts > 0 ? Math.round(stats.fails / stats.starts * 100) : 0,
          avgAttempts: stats.completes > 0 ? Math.round(stats.totalAttempts / stats.completes * 10) / 10 : 0,
          abandonRate: stats.starts > 0 ? Math.round(stats.abandons / stats.starts * 100) : 0
        };
      })
      .filter(a => a.failRate > 30 || a.abandonRate > 20) // åªè¿”å›æœ‰é—®é¢˜çš„å…³å¡
      .sort((a, b) => b.failRate - a.failRate);
  }

  /**
   * ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š
   */
  async generateReport(userId: string): Promise<string> {
    const retention = await this.calculateRetention(userId);
    const habits = await this.analyzeLearningHabits(userId);
    const bottlenecks = await this.analyzeBottlenecks(userId);
    
    return `
## ğŸ“Š å­¦ä¹ æ•°æ®æŠ¥å‘Š

### ç•™å­˜æƒ…å†µ
- æ¬¡æ—¥ç•™å­˜: ${retention.d1}%
- 7æ—¥ç•™å­˜: ${retention.d7}%
- 30æ—¥ç•™å­˜: ${retention.d30}%

### å­¦ä¹ ä¹ æƒ¯
- åå¥½å­¦ä¹ æ—¶æ®µ: ${habits.preferredHours.map(h => `${h}:00`).join(', ')}
- å¹³å‡æ¯æ¬¡å­¦ä¹ æ—¶é•¿: ${habits.avgSessionDuration} åˆ†é’Ÿ
- å¹³å‡æ¯æ¬¡å®Œæˆå…³å¡: ${habits.avgLevelsPerSession} ä¸ª
- æœ¬å‘¨å­¦ä¹ å¤©æ•°: ${habits.weeklyFrequency} å¤©

### éœ€å…³æ³¨çš„å…³å¡
${bottlenecks.slice(0, 5).map(b => 
  `- ${b.courseId} Level ${b.levelId}: å¤±è´¥ç‡ ${b.failRate}%, æ”¾å¼ƒç‡ ${b.abandonRate}%`
).join('\n')}
    `.trim();
  }
}

export const analysisService = new AnalysisService();
```

### ğŸ“¤ Output
- `src/services/analysisService.ts`

---

## Step B.4: Zeabur æ•°æ®å¤‡ä»½æ–¹æ¡ˆ

### ğŸ“ Spec

```typescript
// ============================================================
// æ–‡ä»¶: src/components/settings/DataBackup.tsx
// ============================================================

import React, { useState } from 'react';
import { storageService } from '../../services/storageService';

const DataBackup: React.FC = () => {
  const [exporting, setExporting] = useState(false);
  const [importing, setImporting] = useState(false);

  // === å¯¼å‡ºæ•°æ® ===
  const handleExport = async () => {
    setExporting(true);
    try {
      const data = await storageService.exportAllData();
      
      // åˆ›å»ºä¸‹è½½é“¾æ¥
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `zlearn_backup_${new Date().toISOString().slice(0, 10)}.json`;
      a.click();
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('å¯¼å‡ºå¤±è´¥:', error);
    } finally {
      setExporting(false);
    }
  };

  // === å¯¼å…¥æ•°æ® ===
  const handleImport = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    setImporting(true);
    try {
      const text = await file.text();
      await storageService.importData(text);
      alert('æ•°æ®æ¢å¤æˆåŠŸï¼');
    } catch (error) {
      console.error('å¯¼å…¥å¤±è´¥:', error);
      alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
    } finally {
      setImporting(false);
    }
  };

  return (
    <div className="p-6 bg-slate-800 rounded-xl space-y-6">
      <h3 className="text-xl font-bold">ğŸ’¾ æ•°æ®å¤‡ä»½</h3>
      
      {/* å¯¼å‡º */}
      <div>
        <h4 className="font-medium mb-2">å¯¼å‡ºæ•°æ®</h4>
        <p className="text-sm text-slate-400 mb-3">
          å°†å­¦ä¹ è¿›åº¦ã€è¯¾ç¨‹æ•°æ®ã€åˆ†ææ•°æ®å¯¼å‡ºä¸º JSON æ–‡ä»¶
        </p>
        <button
          onClick={handleExport}
          disabled={exporting}
          className="px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 rounded-lg"
        >
          {exporting ? 'å¯¼å‡ºä¸­...' : 'ğŸ“¥ å¯¼å‡ºå¤‡ä»½'}
        </button>
      </div>
      
      {/* å¯¼å…¥ */}
      <div>
        <h4 className="font-medium mb-2">æ¢å¤æ•°æ®</h4>
        <p className="text-sm text-slate-400 mb-3">
          ä»ä¹‹å‰å¯¼å‡ºçš„ JSON æ–‡ä»¶æ¢å¤æ•°æ®
        </p>
        <label className="inline-block px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg cursor-pointer">
          {importing ? 'å¯¼å…¥ä¸­...' : 'ğŸ“¤ é€‰æ‹©å¤‡ä»½æ–‡ä»¶'}
          <input
            type="file"
            accept=".json"
            onChange={handleImport}
            className="hidden"
          />
        </label>
      </div>
      
      {/* Zeabur å­˜å‚¨æç¤º */}
      <div className="p-4 bg-slate-700/50 rounded-xl">
        <h4 className="font-medium mb-2">â˜ï¸ Zeabur äº‘å­˜å‚¨ (å¯é€‰)</h4>
        <p className="text-sm text-slate-400 mb-2">
          å¯å°†å¤‡ä»½æ–‡ä»¶ä¸Šä¼ åˆ° Zeabur Object Storage å®ç°äº‘ç«¯å¤‡ä»½ï¼š
        </p>
        <ol className="text-sm text-slate-400 list-decimal list-inside space-y-1">
          <li>åœ¨ Zeabur æ§åˆ¶å°åˆ›å»º Object Storage æœåŠ¡</li>
          <li>è·å– Bucket åç§°å’Œ Access Key</li>
          <li>ä½¿ç”¨ S3 å…¼å®¹ API ä¸Šä¼ å¤‡ä»½æ–‡ä»¶</li>
        </ol>
        <a
          href="https://zeabur.com/docs/zh-CN/storage"
          target="_blank"
          rel="noopener noreferrer"
          className="inline-block mt-3 text-blue-400 hover:text-blue-300"
        >
          æŸ¥çœ‹ Zeabur å­˜å‚¨æ–‡æ¡£ â†’
        </a>
      </div>
    </div>
  );
};

export default DataBackup;
```

### Zeabur éƒ¨ç½²å¤‡ä»½æ–¹æ¡ˆ

```markdown
## Zeabur æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æœ¬åœ°å¯¼å‡º + æ‰‹åŠ¨ä¸Šä¼  (æ¨è MVP)
1. ç”¨æˆ·ç‚¹å‡»"å¯¼å‡ºå¤‡ä»½"ä¸‹è½½ JSON æ–‡ä»¶
2. æ‰‹åŠ¨ä¿å­˜åˆ°æœ¬åœ°æˆ–äº‘ç›˜
3. éœ€è¦æ¢å¤æ—¶é€‰æ‹©æ–‡ä»¶å¯¼å…¥

### æ–¹æ¡ˆ 2: Zeabur Object Storage (è¿›é˜¶)
1. åœ¨ Zeabur åˆ›å»º Object Storage æœåŠ¡
2. é…ç½®ç¯å¢ƒå˜é‡:
   - ZEABUR_STORAGE_BUCKET
   - ZEABUR_STORAGE_KEY
   - ZEABUR_STORAGE_SECRET
3. ä½¿ç”¨ S3 SDK è‡ªåŠ¨ä¸Šä¼ å¤‡ä»½

### æ–¹æ¡ˆ 3: å¤–éƒ¨æ•°æ®åº“ (ä¼ä¸šçº§)
1. ä½¿ç”¨ Zeabur çš„ PostgreSQL æœåŠ¡
2. å°† IndexedDB æ•°æ®åŒæ­¥åˆ°äº‘ç«¯
3. æ”¯æŒå¤šè®¾å¤‡åŒæ­¥
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### Phase A: å†…å®¹å¯¼å…¥ (3 ä¸ªæ–‡ä»¶)
```
src/services/
â”œâ”€â”€ importService.ts           # æ–°å¢ - PDF/MD/URL å¯¼å…¥
â”œâ”€â”€ courseGeneratorService.ts  # æ–°å¢ - AI è¯¾ç¨‹ç”Ÿæˆ

src/components/course/
â””â”€â”€ CourseCreator.tsx          # æ–°å¢ - è¯¾ç¨‹åˆ›å»ºå‘å¯¼
```

### Phase B: æ•°æ®åˆ†æ (4 ä¸ªæ–‡ä»¶)
```
src/services/
â”œâ”€â”€ storageService.ts          # æ–°å¢ - IndexedDB å°è£…
â”œâ”€â”€ analyticsService.ts        # æ–°å¢ - åŸ‹ç‚¹æ”¶é›†
â”œâ”€â”€ analysisService.ts         # æ–°å¢ - åˆ†æå¼•æ“

src/components/settings/
â””â”€â”€ DataBackup.tsx             # æ–°å¢ - æ•°æ®å¤‡ä»½UI
```

---

## â±ï¸ æ—¶é—´åˆ†é…

| æ­¥éª¤ | å†…å®¹ | é¢„ä¼° | ä¼˜å…ˆçº§ |
|-----|------|-----|-------|
| A.1 | å¯¼å…¥æœåŠ¡ | 45min | P0 |
| A.2 | AI ç”ŸæˆæœåŠ¡ | 60min | P0 |
| A.3 | åˆ›å»ºå‘å¯¼ UI | 60min | P0 |
| A.4 | åŠ¨æ€è¯¾ç¨‹ç®¡ç† | 30min | P1 |
| B.1 | IndexedDB å­˜å‚¨ | 45min | P0 |
| B.2 | åŸ‹ç‚¹æ”¶é›† | 30min | P0 |
| B.3 | åˆ†æå¼•æ“ | 45min | P1 |
| B.4 | æ•°æ®å¤‡ä»½ | 30min | P1 |
| **æ€»è®¡** | | **6-7h** | |

---

## âœ… éªŒæ”¶æ¸…å•

### Phase A éªŒæ”¶
- [ ] å¯ä¸Šä¼  PDF å¹¶è§£ææ–‡æœ¬
- [ ] å¯ç²˜è´´ Markdown å¹¶è§£æ
- [ ] å¯è¾“å…¥ URL æŠ“å–ç½‘é¡µå†…å®¹
- [ ] é…ç½®ç•Œé¢å¯è®¾ç½®åœ°å›¾æ•°/å…³å¡æ•°/éš¾åº¦æ¨¡å¼
- [ ] AI å¯æ ¹æ®å†…å®¹ç”Ÿæˆè¯¾ç¨‹
- [ ] è‡ªå®šä¹‰è¯¾ç¨‹æ˜¾ç¤ºåœ¨è¯¾ç¨‹åˆ‡æ¢ Tab
- [ ] è‡ªå®šä¹‰è¯¾ç¨‹å¯æ­£å¸¸é—¯å…³

### Phase B éªŒæ”¶
- [ ] IndexedDB å¯å­˜å‚¨åŸ‹ç‚¹äº‹ä»¶
- [ ] å…³å¡å¼€å§‹/å®Œæˆ/å¤±è´¥äº‹ä»¶æ­£ç¡®è®°å½•
- [ ] å¯å¯¼å‡ºå…¨éƒ¨æ•°æ®ä¸º JSON
- [ ] å¯ä» JSON æ¢å¤æ•°æ®
- [ ] ç•™å­˜åˆ†ææ•°æ®æ­£ç¡®è®¡ç®—
- [ ] å­¦ä¹ ä¹ æƒ¯åˆ†æç»“æœåˆç†

---

## ğŸš€ å¼€å§‹å¼€å‘

æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œï¼š

1. **Step A.1**: `importService.ts` - å†…å®¹å¯¼å…¥æ ¸å¿ƒ
2. **Step B.1**: `storageService.ts` - æ•°æ®å­˜å‚¨åŸºç¡€
3. **Step A.2**: `courseGeneratorService.ts` - AI ç”Ÿæˆ
4. **Step B.2**: `analyticsService.ts` - åŸ‹ç‚¹æ”¶é›†
5. **Step A.3**: `CourseCreator.tsx` - åˆ›å»ºå‘å¯¼ UI
6. **Step B.3**: `analysisService.ts` - åˆ†æå¼•æ“
7. **Step A.4**: åŠ¨æ€è¯¾ç¨‹ç®¡ç†é›†æˆ
8. **Step B.4**: `DataBackup.tsx` - å¤‡ä»½ UI

**å¼€å§‹å§ï¼** ğŸ¯

